# Ch1 자바 8~11 무슨 일이 일어나고 있는가?

## 이 장의 내용

- 자바가 거듭 변화하는 이유
- 컴퓨팅 환경의 변화
- 자바에 부여되는 시대적 변화 요구
- 자바 8과 자바9의 새로운 핵심 기능 소개

## 1.1 역사의 흐름은 무엇인가?

자바 8은 간결한 코드, 멀티코어 프로세스의 쉬운 활용이라는 두가지 요구사항을 기반으로 한다.

자바 8 이전에는 병렬 실행 환경을 관리하기 위해 자바 1.0의 스레드와 락,

메모리 모델부터 자바5의 스레드 풀, 병렬 실행 컬렉션, 자바 7의 포크/조인 프레임워크 등의 도구를 지원해왔다. 

개발자가 활용하기 어려웠고 자바 8에서는 병렬 실행을 새롭고 단순한 방식으로 접근할 수 있는 방법을 제공한다. 

## 1.2.2 스트림 처리

스트림이란 한번에 한 개씩 만들어지는 연속적인 데이터 항목들의 모임

프로그램은 입력 스트림에서 데이터를 한 개씩 읽어들이며, 출력 스트림으로 데이터를 한개씩 기록

즉, 어떤 프로그램의 출력 스트림은 다른 프로그램의 입력 스트림이 될 수 있다.

스트림 API의 핵심은 기존에는 한번에 한 항목씩 처리했던 작업을 데이터베이스 질의처럼고수준으로 추상화해서 일련의 스트림으로 만들어 처리할 수 있다는 것이다. 

또한 스트림 파이프라인을 이요하면 입력 부분을 여러 CPU 코어에 쉽게 할당할 수 있다는 장점도 있다.

## 1.2.3 동작 파라미터화로 메서드에 코드 전달하기

자바 8에 추가된 두 번째 프로그램 개념은 코드 일부를 API로 전달하는 기능이다.

기존의 자바에서 sort에 특정한 정렬 순서를 지정하기 위해서는 Comparator 객체를 만들어서 sort 메서드에 전달해주어야 했다. 하지만 이는 너무 복잡하며 기존 동작을 단순하게 재활용한다는 측면에서도 맞지 않다.

**Comparator을 사용한 사용자지정 정렬**

```java
Collections.sort(inventory, new Comparator<Apple>() {
  public int compare(Apple a1, Apple a2) {
    return a1.getWeight().compareTo(a2.getWeigth());
  }
});
```

자바 8에서는 메서드를 다른 메서드의 인수로 넘겨주는 기능을 제공하며, 이러한 기능을 **동작 파라미터화**라고 부른다.

## 1.2.4 병렬성과 공유 가변 데이터

보통 다른 코드와 동시에 실행하더라도 안전하게 실행할 수 있는 코드를 만들려면 공유된 가변 데이터에 접근하지 않아야 한다.

기존에는 synchronized를 이용해서 공유된 가변 데이터를 보호하는 규칙을 만들었으나, 자바 8의 스트림을 이용하면 기존의 자바 스레드 API보다 쉽게 병렬성을 활용할 수 있다.

# 1.3 자바함수

## 1.3.1 메서드와 람다를 일급시민으로

기존에 객체 참조(new로 객체 참조를 생성함)를 이용해서 객체를 주고받았던 것처럼 자바 8에서는 메서드 참조를 만들어 전달할 수 있다.

# 1.4 스트림

기존의 컬렉션 API에서는 for-each 루프를 통한 반복 과정을 직접 처리했다.

이러한 방식을 외부 반복(external iteration)이라 한다.

반면 스트림 API를 이용하면 루프를 신경 쓸 필요가 없다.

내부 반복(internal iteration) 방식을 사용해 API 내부에서 모든 데이터가 처리되기 때문이다.

## 1.4.1 멀티스레딩은 어렵다

스트림 API는 기존 자바에서 발생하던 두가지 문제를 모두 해결했다

- 컬렉션을 처리하며 발생하는 모호함과 반복적인 코드 문제
- 멀티 코어활용 어려움

데이터 필터링, 추출, 그룹화 하는 기능들의 패턴을 제공하고 

이 동작들을 쉽게 병렬화 할 수 있다. 

### **1.5 디폴트 메서드와 자바 모듈**

자바 9의 모듈 시스템은 모듈을 정의하는 문법을 제공한다. 이를 통해 패키지 모음을 포함하는 모듈을 정의할 수 있다.

모듈 덕분에 JAR 같은 컴포넌트에 구조를 적용할 수 있으며 문서화와 모듈 확인 작업이 용이해졌다.

또한 자바 8에서는 인터페이스를 쉽게 바꿀 수 있도록 디폴트 메서드를 지원한다.

구현 클래스에서 구현하지 않아도 되는 메서드를 인터페이스에 추가할 수 있는 기능을 제공하며, 메서드 본문은 클래스 구현이 아니라 인터페이스 일부로 포함된다.

예를 들어 자바 8에서는 List에 직접 sort 메서드를 호출할 수 있다. 이는 자바 8의 List 인터페이스에 다음과 같은 디폴트 메서드 정의가 추가되었기 때문이다.

```java
default void sort(Comparator<? super E> C) {
  Collections.sort(this, c);
}
```

참고

[https://highlighter9.tistory.com/39](https://highlighter9.tistory.com/39)
